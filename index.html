<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>医心方数字文献库</title>
    <!-- 霞鹜文楷（开源楷体） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont/style.css">
    <!-- 备用：Noto Serif SC -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">
    <!-- DOMPurify（用于净化允许的 HTML） -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimSun", "宋体", serif;
        }

        body {
            background-color: #f8f6f2;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.03"><rect fill="%23000" width="100" height="100"/></svg>');
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: 1px solid #e8e4dc;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #c8b99c;
        }
        
        .header-title {
            font-size: 2.5rem;
            color: #8a3324;
            margin-bottom: 10px;
            font-weight: normal;
            letter-spacing: 2px;
        }
        
        .header-subtitle {
            font-size: 1rem;
            color: #7a6a52;
            font-style: italic;
        }
        
        .nav {
            margin-bottom: 30px;
        }
        
        .nav-list {
            display: flex;
            justify-content: center;
            list-style: none;
            flex-wrap: wrap;
            border-bottom: 1px solid #e8e4dc;
        }
        
        .nav-item {
            margin: 0 5px;
        }
        
        .nav-link {
            display: block;
            padding: 10px 20px;
            color: #7a6a52;
            text-decoration: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            color: #8a3324;
            border-bottom: 3px solid #8a3324;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* 统计卡片样式 */
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: #f3efe8;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 150px;
            margin: 10px;
            border: 1px solid #e8e4dc;
        }
        
        .stat-number {
            font-size: 2rem;
            color: #8a3324;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7a6a52;
            font-size: 0.9rem;
        }
        
        /* 搜索框样式 */
        .search-section {
            background: #f9f7f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #e8e4dc;
        }
        
        .search-box {
            padding: 12px 20px;
            width: 70%;
            max-width: 500px;
            border: 1px solid #d6cfc0;
            border-radius: 4px;
            font-size: 1rem;
            margin: 15px 10px;
            outline: none;
            transition: border 0.3s;
        }
        
        .search-box:focus {
            border-color: #8a3324;
        }
        
        .btn {
            padding: 12px 25px;
            background: #8a3324;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #6d281c;
        }
        
        /* 卷目网格样式 */
        .volume-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .volume-card {
            background: #f9f7f3;
            border: 1px solid #e8e4dc;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .volume-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .volume-number {
            display: inline-block;
            background: #8a3324;
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .volume-title {
            font-size: 1.2rem;
            color: #8a3324;
            margin-bottom: 10px;
        }
        
        .volume-description {
            color: #7a6a52;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* 药物辞典样式 */
        .drugs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .drug-card {
            background: #f9f7f3;
            border: 1px solid #e8e4dc;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .drug-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .drug-name {
            font-size: 1.3rem;
            color: #8a3324;
            margin-bottom: 10px;
            border-bottom: 1px solid #e8e4dc;
            padding-bottom: 8px;
        }
        
        .drug-pinyin {
            color: #7a6a52;
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .drug-latin {
            color: #5a4a32;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .drug-properties {
            color: #7a6a52;
            font-size: 0.9rem;
            margin-bottom: 10px;
            flex-grow: 1;
        }
        
        .drug-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .drug-tag {
            background: #e8e4dc;
            color: #5a4a32;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        /* 药物详情样式 */
        .drug-detail {
            display: none;
            margin-top: 30px;
            background: #f9f7f3;
            border: 1px solid #e8e4dc;
            border-radius: 8px;
            padding: 25px;
        }
        
        .drug-detail.active {
            display: block;
        }
        
        .drug-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 1px solid #e8e4dc;
            padding-bottom: 15px;
        }
        
        .drug-detail-name {
            font-size: 1.8rem;
            color: #8a3324;
            margin-bottom: 5px;
        }
        
        .drug-detail-pinyin {
            color: #7a6a52;
            font-style: italic;
            font-size: 1.1rem;
        }
        
        .drug-detail-latin {
            color: #5a4a32;
            font-size: 1rem;
            margin-top: 5px;
        }
        
        .drug-detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .drug-detail-section {
            margin-bottom: 20px;
        }
        
        .drug-detail-section h3 {
            color: #8a3324;
            font-size: 1.2rem;
            margin-bottom: 10px;
            border-bottom: 1px solid #e8e4dc;
            padding-bottom: 5px;
        }
        
        .drug-detail-text {
            line-height: 1.6;
            color: #5a4a32;
        }
        
        .drug-detail-image {
            max-width: 100%;
            border-radius: 4px;
            border: 1px solid #e8e4dc;
            margin-top: 10px;
        }
        
        /* 卷详情样式 */
        #volume-detail {
            display: none;
            margin-top: 30px;
        }
        
        .back-btn {
            background: #7a6a52;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            background: #635945;
        }
        
        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .page-card {
            background: white;
            border: 1px solid #e8e4dc;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-card:hover {
            border-color: #8a3324;
            box-shadow: 0 5px 15px rgba(138, 51, 36, 0.1);
        }
        
        .page-number {
            display: block;
            font-size: 1.2rem;
            color: #8a3324;
            margin-bottom: 8px;
        }
        
        .page-preview {
            height: 120px;               /* 保持高度 */
            background: none;             /* 去掉背景色 */
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7a6a52;
            font-size: 1.2rem;            /* 字体减小 */
            overflow: hidden;
            position: relative;
        }

        /* PDF查看器样式 */
        .pdf-viewer-container {
            display: none;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #e8e4dc;
            border-radius: 8px;
            background: #f9f7f3;
            padding: 20px;
        }
        
        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e8e4dc;
        }
        
        .viewer-title {
            font-size: 1.2rem;
            color: #8a3324;
        }
        
        .viewer-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .viewer-btn {
            padding: 8px 12px;
            background: #7a6a52;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .viewer-btn:hover {
            background: #635945;
        }
        
        .pdf-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .page-navigation {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .page-input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #d6cfc0;
            border-radius: 4px;
            text-align: center;
        }
        
        .zoom-controls {
            display: flex;
            gap: 5px;
        }
        
        .control-btn {
            background: #7a6a52;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: #635945;
        }
        
        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .page-info {
            font-size: 1rem;
            color: #7a6a52;
        }
        
        /* iframe 样式 */
        .pdf-iframe {
            width: 100%;
            height: 70vh;
            border: 1px solid #e8e4dc;
            border-radius: 4px;
            background: white;
        }
        
        /* 查看器主体 */
        .viewer-body {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
            gap: 16px;
            align-items: start;
        }
        .canvas-pane { 
            min-width: 0;
            position: relative;
        }
        .text-pane {
            background: #fff;
            border: 1px solid #e8e4dc;
            border-radius: 6px;
            padding: 12px;
            max-height: 70vh;
            overflow: auto;
            position: sticky;
            top: 12px;
        }
        .text-pane .text-pane-title {
            font-size: 1rem;
            color: #8a3324;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        .text-pane-tools {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        .text-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #d6cfc0;
            border-radius: 4px;
            font-size: 0.95rem;
            outline: none;
        }
        .btn-mini {
            background: #8a3324;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn-mini:hover { background: #6d281c; }
        .page-text { color: #4b463d; line-height: 1.85; white-space: pre-wrap; word-break: break-word; }
        .page-text mark { background: #ffef74; padding: 0 2px; border-radius: 2px; }
        
        /* 加载遮罩 */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 4px;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8a3324;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 搜索结果卡片 */
        .entry-card {
            background: #f9f7f3;
            border: 1px solid #e8e4dc;
            border-radius: 8px;
            padding: 15px;
            margin: 12px 0;
        }
        .entry-title { font-size: 1rem; color: #8a3324; margin-bottom: 6px; }
        .entry-preview { color: #635945; margin: 6px 0; }
        .entry-meta { color: #7a6a52; font-size: 0.85rem; display: flex; gap: 12px; flex-wrap: wrap; }
        .entry-actions { margin-top: 8px; }
        .btn-link { background: #8a3324; color: white; padding: 6px 10px; border-radius: 4px; display: inline-block; cursor: pointer; border: none; }
        .btn-link:hover { background: #6d281c; }
        
        /* 用于 JSON 中的局部楷体标记 */
        .kaiti {
            font-family: "KaiTi", "STKaiti","LXGW WenKai",  "Noto Serif SC", serif !important;
        }
        
        /* 图片查看器样式 */
        .image-viewer {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        
        .image-container {
            max-width: 100%;
            overflow: auto;
            margin-bottom: 15px;
        }
        
        .viewer-image {
            max-width: 100%;
            height: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #e8e4dc;
        }
        
        .tooltip {
            cursor: help;
            font-weight: normal;          
            color: inherit;               
            border-bottom: 1px dashed #8a3324;  
        }

        .tooltip-float {
            position: absolute;
            z-index: 99999;
            max-width: 400px;       
            background: #f9f7f3;
            color: #4b463d;
            padding: 10px 12px;
            border: 1px solid #e8e4dc;
            border-radius: 6px;
            font-size: 0.95rem;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .volume-grid, .drugs-grid {
                grid-template-columns: 1fr;
            }
            .pages-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .search-box {
                width: 100%;
                margin: 15px 0;
            }
            .viewer-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            .viewer-controls {
                width: 100%;
                justify-content: space-between;
            }
            .viewer-body {
                grid-template-columns: 1fr;
            }
            .text-pane { 
                position: static; 
                max-height: none; 
            }
            .drug-detail-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="header-title">医心方数字文献库</h1>
            <p class="header-subtitle">现存最古日本医学典籍 · 数字化研究平台</p>
        </header>
        
        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="home" onclick="showSection('home')">首页</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="browse" onclick="showSection('browse')">浏览全书</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="drugs" onclick="showSection('drugs')">药物辞典</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="search" onclick="showSection('search')">文本搜索</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="about" onclick="showSection('about')">关于项目</a>
                </li>
            </ul>
        </nav>
        
        <main class="main-content">
            <!-- 首页 -->
            <section id="home" class="content-section active">
                <div class="search-section">
                    <h2>快速检索</h2>
                    <input id="quick-search-input" type="text" class="search-box" placeholder="输入关键词搜索《医心方》全文...">
                    <button class="btn" onclick="performSearch()">搜索</button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">30</div>
                        <div class="stat-label">卷数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2000+</div>
                        <div class="stat-label">条文数量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">300+</div>
                        <div class="stat-label">药物条目</div>
                    </div>
                </div>
                
                <h2>项目简介</h2>
                <p style="line-height: 1.8; color: #555; margin-top: 15px;text-indent: 2em;">
                        本网站基于现存最古老的日本医学典籍——半井本《医心方》的文献表征与文本信息特征，构建了专门化的古籍数字化平台，旨在推动古籍数字化向更加精细化、学术化和个性化的方向发展。网站提供全文检索、图文对照、药物辞典、资源导航等核心功能模块，为学者研究提供便利工具。
                 <p style="text-indent: 2em; font-weight: bold;"> 声明：本网站所有资源均用于学术知识交流，不作商业用途。</p>
            </section>
            
            <!-- 浏览全书 -->
            <section id="browse" class="content-section">
                <h2>《医心方》卷目浏览</h2>
                <div class="volume-grid">
                    <!-- 30卷内容 -->
                    <div class="volume-card" onclick="showVolume(1)">
                        <span class="volume-number">第1卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷一 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(2)">
                        <span class="volume-number">第2卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(3)">
                        <span class="volume-number">第3卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷三 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(4)">
                        <span class="volume-number">第4卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷四 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(5)">
                        <span class="volume-number">第5卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷五 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(6)">
                        <span class="volume-number">第6卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷六 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(7)">
                        <span class="volume-number">第7卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷七 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(8)">
                        <span class="volume-number">第8卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷八 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(9)">
                        <span class="volume-number">第9卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷九 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(10)">
                        <span class="volume-number">第10卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(11)">
                        <span class="volume-number">第11卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十一 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(12)">
                        <span class="volume-number">第12卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十二 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(13)">
                        <span class="volume-number">第13卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十三 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(14)">
                        <span class="volume-number">第14卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十四 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(15)">
                        <span class="volume-number">第15卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十五 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(16)">
                        <span class="volume-number">第16卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十六 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(17)">
                        <span class="volume-number">第17卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十七 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(18)">
                        <span class="volume-number">第18卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十八 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(19)">
                        <span class="volume-number">第19卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷十九 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(20)">
                        <span class="volume-number">第20卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(21)">
                        <span class="volume-number">第21卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十一 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(22)">
                        <span class="volume-number">第22卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十二 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(23)">
                        <span class="volume-number">第23卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十三 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(24)">
                        <span class="volume-number">第24卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十四 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(25)">
                        <span class="volume-number">第25卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十五 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(26)">
                        <span class="volume-number">第26卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十六 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(27)">
                        <span class="volume-number">第27卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十七 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(28)">
                        <span class="volume-number">第28卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十八 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(29)">
                        <span class="volume-number">第29卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷二十九 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                    <div class="volume-card" onclick="showVolume(30)">
                        <span class="volume-number">第30卷</span>
                        <div class="volume-title">医心方 丹波康赖撰</div>
                        <div class="volume-description">医心方 丹波康赖撰 卷三十 总三十卷 十二世纪抄本 东京国立博物馆藏</div>
                    </div>
                </div>
                
                <div id="volume-detail">
                    <!-- 卷详情内容由 JS 动态生成 -->
                </div>
                
                <!-- PDF查看器 -->
                <div class="pdf-viewer-container" id="pdf-viewer">
                    <div class="viewer-header">
                        <div class="viewer-title" id="viewer-title">PDF预览</div>
                        <div class="viewer-controls">
                            <button class="viewer-btn" onclick="downloadCurrentPDF()">
                                <i class="fas fa-download"></i> 打开/下载PDF
                            </button>
                            <button class="viewer-btn" onclick="openViewerInNewTab()">
                                <i class="fas fa-external-link-alt"></i> 在新标签中打开
                            </button>
                            <button class="viewer-btn" onclick="backToPages()">
                                <i class="fas fa-arrow-left"></i> 返回
                            </button>
                        </div>
                    </div>
                    
                    <div class="pdf-controls">
                        <div class="page-navigation">
                            <button class="control-btn" id="prev-btn" onclick="prevPage()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <div class="page-input-group">
                                <input type="number" id="page-input" class="page-input" min="1">
                                <span class="page-info"> / <span id="page-count">?</span></span>
                            </div>
                            
                            <button class="control-btn" id="next-btn" onclick="nextPage()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="zoom-controls">
                            <button class="control-btn" onclick="zoomOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="control-btn" onclick="zoomIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="control-btn" onclick="fitWidth()">
                                <i class="fas fa-arrows-alt-h"></i>
                            </button>
                            <button class="control-btn" onclick="fitPage()">
                                <i class="fas fa-arrows-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 查看器主体 -->
                    <div class="viewer-body">
                        <div class="canvas-pane">
                            <!-- 加载遮罩 -->
                            <div class="loading-overlay" id="pdf-loading">
                                <div class="loader-spinner"></div>
                            </div>
                            <!-- PDF iframe -->
                            <iframe id="pdf-iframe" class="pdf-iframe" src="" frameborder="0"></iframe>
                        </div>
                        <aside class="text-pane">
                            <div class="text-pane-title">
                                <span>第<span id="current-page-text">1</span>页文本</span>
                                <button class="btn-mini" id="copy-page-text" title="复制文本">复制</button>
                            </div>
                            <div class="text-pane-tools">
                                <input id="page-text-search" class="text-input" type="text" placeholder="在本页文本内查找">
                            </div>
                            <div id="page-text" class="page-text">暂无文本</div>
                        </aside>
                    </div>
                </div>
                
                <!-- 图片查看器（作为PDF备用） -->
                <div class="image-viewer" id="image-viewer">
                    <div class="viewer-header">
                        <div class="viewer-title" id="image-viewer-title">图片预览</div>
                        <div class="viewer-controls">
                            <button class="viewer-btn" onclick="downloadCurrentImage()">
                                <i class="fas fa-download"></i> 下载图片
                            </button>
                            <button class="viewer-btn" onclick="backToPages()">
                                <i class="fas fa-arrow-left"></i> 返回
                            </button>
                        </div>
                    </div>
                    
                    <div class="image-container">
                        <img id="viewer-image" class="viewer-image" src="" alt="页面图片">
                    </div>
                    
                    <div class="pdf-controls">
                        <div class="page-navigation">
                            <button class="control-btn" id="image-prev-btn" onclick="prevImagePage()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <div class="page-input-group">
                                <input type="number" id="image-page-input" class="page-input" min="1">
                                <span class="page-info"> / <span id="image-page-count">?</span></span>
                            </div>
                            
                            <button class="control-btn" id="image-next-btn" onclick="nextImagePage()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="zoom-controls">
                            <button class="control-btn" onclick="zoomImageOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="control-btn" onclick="zoomImageIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="control-btn" onclick="resetImageZoom()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <aside class="text-pane">
                        <div class="text-pane-title">
                            <span>第<span id="current-image-page-text">1</span>页文本</span>
                            <button class="btn-mini" id="copy-image-page-text" title="复制文本">复制</button>
                        </div>
                        <div class="text-pane-tools">
                            <input id="image-page-text-search" class="text-input" type="text" placeholder="在本页文本内查找">
                        </div>
                        <div id="image-page-text" class="page-text">暂无文本</div>
                    </aside>
                </div>
            </section>
            
            <!-- 药物辞典页面 -->
            <section id="drugs" class="content-section">
                <div class="search-section">
                    <h2>药物辞典检索</h2>
                    <input type="text" class="search-box" id="drug-search-input" placeholder="输入药物名称、拼音或拉丁名搜索...">
                    <div class="search-filters" style="margin-top:10px; display:flex; gap:16px; justify-content:center; flex-wrap:wrap;">
                        <div class="filter-group">
                            <select id="drug-category-filter">
                                <option value="">所有分类</option>
                                <option value="解表药">解表药</option>
                                <option value="清热药">清热药</option>
                                <option value="泻下药">泻下药</option>
                                <option value="祛风湿药">祛风湿药</option>
                                <option value="化湿药">化湿药</option>
                                <option value="利水渗湿药">利水渗湿药</option>
                                <option value="温里药">温里药</option>
                                <option value="理气药">理气药</option>
                                <option value="消食药">消食药</option>
                                <option value="驱虫药">驱虫药</option>
                                <option value="止血药">止血药</option>
                                <option value="活血化瘀药">活血化瘀药</option>
                                <option value="化痰止咳平喘药">化痰止咳平喘药</option>
                                <option value="安神药">安神药</option>
                                <option value="平肝息风药">平肝息风药</option>
                                <option value="开窍药">开窍药</option>
                                <option value="补虚药">补虚药</option>
                                <option value="收涩药">收涩药</option>
                                <option value="涌吐药">涌吐药</option>
                                <option value="攻毒杀虫止痒药">攻毒杀虫止痒药</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="performDrugSearch()" style="margin-top:10px;">搜索</button>
                </div>
                
                <div id="drugs-grid-container">
                    <div class="drugs-grid" id="drugs-grid">
                        <!-- 药物卡片将由JS动态生成 -->
                    </div>
                </div>
                
                <div class="drug-detail" id="drug-detail">
                    <!-- 药物详情将由JS动态生成 -->
                </div>
            </section>
            
            <!-- 搜索页面 -->
            <section id="search" class="content-section">
                <div class="search-section">
                    <h2>全文检索</h2>
                    <input type="text" class="search-box" id="search-input" placeholder="输入关键词搜索...">
                    <div class="search-filters" style="margin-top:10px; display:flex; gap:16px; justify-content:center; flex-wrap:wrap;">
                        <div class="filter-group">
                            <input type="checkbox" id="filter-exact">
                            <label for="filter-exact">精确匹配</label>
                        </div>
                        <div class="filter-group">
                            <select id="search-volume-filter">
                                <option value="">所有卷目</option>
                                <option value="1">第1卷</option>
                                <option value="2">第2卷</option>
                                <option value="3">第3卷</option>
                                <option value="4">第4卷</option>
                                <option value="5">第5卷</option>
                                <option value="6">第6卷</option>
                                <option value="7">第7卷</option>
                                <option value="8">第8卷</option>
                                <option value="9">第9卷</option>
                                <option value="10">第10卷</option>
                                <option value="11">第11卷</option>
                                <option value="12">第12卷</option>
                                <option value="13">第13卷</option>
                                <option value="14">第14卷</option>
                                <option value="15">第15卷</option>
                                <option value="16">第16卷</option>
                                <option value="17">第17卷</option>
                                <option value="18">第18卷</option>
                                <option value="19">第19卷</option>
                                <option value="20">第20卷</option>
                                <option value="21">第21卷</option>
                                <option value="22">第22卷</option>
                                <option value="23">第23卷</option>
                                <option value="24">第24卷</option>
                                <option value="25">第25卷</option>
                                <option value="26">第26卷</option>
                                <option value="27">第27卷</option>
                                <option value="28">第28卷</option>
                                <option value="29">第29卷</option>
                                <option value="30">第30卷</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="performDetailedSearch()" style="margin-top:10px;">搜索</button>
                </div>
                <div id="search-results"></div>
            </section>
            
            <!-- 关于项目 -->
            <section id="about" class="content-section">
                <h2>关于本项目</h2>
                <div style="line-height: 1.8; color: #555;">
                    <h3>项目目标</h3>
                    <p style="text-indent: 2em;"> 本网站基于现存最古老的日本医学典籍——半井本《医心方》的文献表征与文本信息特征，构建了专门化的古籍数字化平台，旨在推动古籍数字化向更加精细化、学术化和个性化的方向发展。</p>
                    <p style="text-indent: 2em;"> 在文献表征层面，针对该书异体字繁多、字迹色彩丰富、正文-注释-旁注复合结构等独特的视觉特征，本研究采用图文对照技术，最大程度地保留文献的原始形态，并设计了层次化标注体系，实现对不同文本层次的精确区分。</p>
                    <p style="text-indent: 2em;"> 在文本信息层面，结合《医心方》大量引用中国典籍的内容特点，本研究创建了字书引用标识系统，以凸显其重要的语言学价值，并开发了引用源流追踪功能，系统标记中国医籍的来源脉络。</p>
                    <p style="text-indent: 2em;"> 网站提供全文检索、图文对照、药物辞典、资源导航等核心功能模块，为学者研究提供便利工具。</p>
                    <p style="text-indent: 2em; font-weight: bold;"> 声明：本网站所有资源均用于学术知识交流，不作商业用途。</p>
                    <h3 style="margin-top: 30px;">《医心方》介绍</h3>
                    <p>（一）版本概况</p>
                    <p style="text-indent: 2em;"> 《医心方》共三十卷，由丹波康赖撰写，成书于日本永观二年（984年，即中国宋雍熙元年）。《医心方》撰成之后便形成了三个版本系统：宇治本、御本和医家本。日本学者杉立义一在《〈医心方〉版本源流考略》一文中，对这一版本系统进行了详细考辨，并绘制了相应的源流图：</p>
                    <!-- 插入图片 -->
                    <div style="text-align: center; margin: 20px 0;">
                    <img src="images/医心方传写系统.png" alt="医心方版本源流图" style="max-width: 50%; height: auto; border: 1px solid #ccc;">
                    </div>
                    <p>（二）半井本《医心方》</p>
                    <p style="text-indent: 2em;"> 天养二年（1145年），日本曾对《医心方》进行了一次重要的整理工作，以御本为底本，与宇治本、医家本相校勘。这次整理的详细情况见于现存半井本《医心方》第八卷卷首的记录。整理结果称为“新御本”，保存在朝廷秘阁之中。</p>
                    <p style="text-indent: 2em;"> 直至天正元年（1573年），新御本被赐予半井瑞策。由此，后来的新御本被称为“半井家本”。昭和57年（1982年），半井家本重新归国家所有，并于1984年被指定为国宝。</p>
                    <div style="text-align: center; margin: 20px 0;">
                    <img src="images/校勘.png" alt="医心方版本源流图" style="max-width: 50%; height: auto; border: 1px solid #ccc;">
                    </div>
                    <p>（三）校勘和数字化价值</p>
                    <p style="text-indent: 2em;"> 《医心方》作为日本现存最古的医书，征引了中国众多典籍，其校勘价值长期以来受到中日学者的共同重视。</p>
                    <p style="text-indent: 2em;"> 关于《医心方》的引用文献情况，日本学者冈西为人、小曾户洋，以及中国中医研究院的马继兴、胡乃长、沈澍农等学者都曾进行过不同程度的研究。沈澍农先生以马继兴的研究为基础，进行了一定的简化和改进。据其统计，《医心方》共引用典籍204种，引文10877条。其中绝大部分为医药典籍，非医书类典籍仅有35种66条。</p>
                    <p>（四）研究资源和网站导航</p>

                    <p style="text-indent: 2em;">1、半井本《医心方》：</p>
                    <p style="text-indent: 2em;">日本E国宝网站 <a href="https://emuseum.nich.go.jp/top?langId=zh" target="_blank">https://emuseum.nich.go.jp/top?langId=zh</a></p>

                    <p style="text-indent: 2em;">2、宇治本、安政本《医心方》：</p>
                    <p style="text-indent: 2em;">国書データベース <a href="https://kokusho.nijl.ac.jp/" target="_blank">https://kokusho.nijl.ac.jp/</a></p>
                    <p style="text-indent: 2em;">国立国会図書館 <a href="https://dl.ndl.go.jp/" target="_blank">https://dl.ndl.go.jp/</a></p>

                    <p style="text-indent: 2em;">3、《医心方》国内出版与研究：</p>
                    <p style="text-indent: 3em;">（1）影印本：</p>
                    <p style="text-indent: 4em;">《医心方》（安政本），人民卫生出版社1993年影印出版</p>

                    <p style="text-indent: 3em;">（2）安政本校对本：</p>
                    <p style="text-indent: 4em;">北京华龄出版社2020年版</p>
                    <p style="text-indent: 4em;">北京人民卫生出版社1955年版</p>
                    <p style="text-indent: 4em;">翟双庆、张瑞贤等校注，北京华夏出版社1993年版</p>

                    <p style="text-indent: 3em;">（3）半井本校对本：</p>
                    <p style="text-indent: 4em;">高文铸等校注，北京华夏出版社2023年版</p>
                    <p style="text-indent: 4em;">高文铸等校注，北京华夏出版社1966年版</p>

                    <p style="text-indent: 2em;">4、《医心方》日本学者研究（专著）：</p>
                    <p style="text-indent: 3em;">《醫心方の伝来》，京都：思文阁出版，1991年版</p>
                    <p style="text-indent: 3em;">《醫心方の研究》，大阪：オリエント出版社，1994年版</p>
                    
                    <h3 style="margin-top: 30px;">本网站参考文献：</h3>
                    <p style="text-indent: 3em;">李景荣等校释《备急干金要方校释》，人民卫生出版社1998年版</p>
                    <p style="text-indent: 3em;">孙猛著《日本国见在书目录详考》，上海古籍出版社2015年版</p>

                    <h3 style="margin-top: 30px;">使用说明</h3>
                    <p>您可以通过导航栏切换不同功能模块，使用搜索功能查找特定内容，或按卷目浏览完整文献与药物辞典。平台同时支持PDF查看，确保在不同环境下都能正常显示文献内容。推荐使用Google Chrome浏览器打开</p>
                    
                </div>
            </section>
        </main>
    </div>

    <script>
        // 卷标题和描述
        const volumeTitles = {};
        const volumeDescriptions = {};
        for (let i = 1; i <= 30; i++) {
            const cnNum = ['一','二','三','四','五','六','七','八','九','十',
                          '十一','十二','十三','十四','十五','十六','十七','十八','十九','二十',
                          '二十一','二十二','二十三','二十四','二十五','二十六','二十七','二十八','二十九','三十'][i-1];
            volumeTitles[i] = `医心方 丹波康赖撰 卷${cnNum}`;
            volumeDescriptions[i] = `医心方 丹波康赖撰 卷${cnNum} 总三十卷 十二世纪抄本 东京国立博物馆藏`;
        }

        // 数据
        let volumePages = {};
        let pageTexts = {};
        let pageMeta = {};
        let searchIndex = [];
        let drugsData = [];
        
        // 状态
        let currentVolume = 0;
        let currentPage = 1;
        let totalPages = 1;
        let currentPDFUrl = '';
        let currentImageUrl = '';
        let currentZoom = 'auto';
        let imageZoom = 1;
        let isLoading = false;
        let lastSearchQuery = "";
        let currentPageTextRaw = "";
        let currentVolumePages = [];
        let currentDrugDetail = null;

        // PDF.js viewer 基础URL（使用Mozilla的在线版本或自己部署的版本）
        const viewerBase = 'https://mozilla.github.io/pdf.js/web/viewer.html';
        // 如果你部署了自己的PDF.js viewer，改为：
        // const viewerBase = '/pdfjs/web/viewer.html';

        // 工具函数
        function escapeRegExp(s) {
            return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        function escapeHTML(s) {
            if (typeof s !== 'string') return s;
            return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        }
        
        function highlightMatches(text, query, exact) {
            if (!query) return text;
            const tokens = exact ? [query] : query.trim().split(/\s+/).filter(Boolean);
            if (!tokens.length) return text;
            const pattern = tokens.map(t => escapeRegExp(t)).join("|");
            const re = new RegExp(pattern, "gi");
            return text.replace(re, m => `<mark>${m}</mark>`);
        }
        
        function getSnippet(text, query, exact, radius = 40) {
            if (!text) return '';
            if (!query) return escapeHTML(text.slice(0, 100)) + (text.length > 100 ? "…" : "");
            const tokens = exact ? [query] : query.trim().split(/\s+/).filter(Boolean);
            if (!tokens.length) return escapeHTML(text.slice(0, 100)) + (text.length > 100 ? "…" : "");
            const pattern = tokens.map(t => escapeRegExp(t)).join("|");
            const re = new RegExp(pattern, "i");
            const m = re.exec(text);
            if (!m) return escapeHTML(text.slice(0, 100)) + (text.length > 100 ? "…" : "");
            const idx = m.index;
            const len = m[0].length;
            const start = Math.max(0, idx - radius);
            const end = Math.min(text.length, idx + len + radius);
            let snippet = text.slice(start, end);
            if (start > 0) snippet = "…" + snippet;
            if (end < text.length) snippet += "…";
            return highlightMatches(escapeHTML(snippet), query, exact);
        }

        // 构建搜索索引
        function buildSearchIndex() {
            searchIndex = [];
            for (const vol in pageTexts) {
                if (!Object.prototype.hasOwnProperty.call(pageTexts, vol)) continue;
                for (const pg in pageTexts[vol]) {
                    if (!Object.prototype.hasOwnProperty.call(pageTexts[vol], pg)) continue;
                    searchIndex.push({
                        volume: Number(vol),
                        page: Number(pg),
                        text: pageTexts[vol][pg] || "",
                        tags: (pageMeta[vol] && pageMeta[vol][pg] && pageMeta[vol][pg].tags) || []
                    });
                }
            }
        }

        // 页面切换
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const sec = document.getElementById(sectionName);
            if (sec) sec.classList.add('active');

            document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
            const link = document.querySelector(`.nav-link[data-section="${sectionName}"]`);
            if (link) link.classList.add('active');

            if (sectionName !== 'browse') {
                document.getElementById('volume-detail').style.display = 'none';
                document.getElementById('pdf-viewer').style.display = 'none';
                document.getElementById('image-viewer').style.display = 'none';
                document.querySelector('.volume-grid').style.display = 'grid';
            }
            
            if (sectionName === 'drugs') {
                // 切换到药物辞典时加载药物数据
                if (drugsData.length === 0) {
                    loadDrugsData();
                } else {
                    displayDrugsGrid(drugsData);
                }
            }
        }

        // 药物辞典功能
        function loadDrugsData() {
            fetch('./drugs.json')
                .then(response => response.json())
                .then(data => {
                    drugsData = data;
                    displayDrugsGrid(data);
                })
                .catch(err => {
                    console.warn('无法加载药物数据:', err);
                    // 示例数据
                    drugsData = [
                        {
                            id: 1,
                            name: "人参",
                            pinyin: "renshen",
                            latin: "Panax ginseng",
                            category: "补虚药",
                            properties: "甘、微苦，平。归脾、肺、心经。",
                            efficacy: "大补元气，复脉固脱，补脾益肺，生津养血，安神益智。",
                            usage: "3～9g，另煎兑服；也可研粉吞服，一次2g，一日2次。",
                            contraindications: "不宜与藜芦、五灵脂同用。",
                            description: "人参为五加科植物人参的干燥根。栽培者为\"园参\"，野生者为\"山参\"。多于秋季采挖，洗净经晒干或烘干。",
                            imageUrl: "./images/renshen.jpg"
                        },
                        {
                            id: 2,
                            name: "黄芪",
                            pinyin: "huangqi",
                            latin: "Astragalus membranaceus",
                            category: "补虚药",
                            properties: "甘，微温。归肺、脾经。",
                            efficacy: "补气升阳，固表止汗，利水消肿，生津养血，行滞通痹，托毒排脓，敛疮生肌。",
                            usage: "9～30g。",
                            contraindications: "表实邪盛、气滞湿阻、食积内停、阴虚阳亢、疮痈初起或溃后热毒尚盛者不宜使用。",
                            description: "黄芪为豆科植物蒙古黄芪或膜荚黄芪的干燥根。春、秋二季采挖，除去须根和根头，晒干。",
                            imageUrl: "./images/huangqi.jpg"
                        }
                    ];
                    displayDrugsGrid(drugsData);
                });
        }

        function displayDrugsGrid(drugs) {
            const gridContainer = document.getElementById('drugs-grid');
            if (!gridContainer) return;
            
            gridContainer.innerHTML = drugs.map(drug => `
                <div class="drug-card" onclick="showDrugDetail(${drug.id})">
                    <div class="drug-name">${drug.name}</div>
                    <div class="drug-pinyin">${drug.pinyin}</div>
                    <div class="drug-latin">${drug.latin}</div>
                    <div class="drug-properties">${drug.properties}</div>
                    <div class="drug-tags">
                        <span class="drug-tag">${drug.category}</span>
                    </div>
                </div>
            `).join('');
        }
        function showDrugDetail(drugId) {
            const drug = drugsData.find(d => d.id === drugId);
            if (!drug) return;
            
            currentDrugDetail = drug;
            const detailContainer = document.getElementById('drug-detail');
            const listContainer = document.getElementById('drugs-grid-container');
            
            detailContainer.innerHTML = `
                <button class="btn back-btn" onclick="backToDrugsList()">返回药物列表</button>
                <div class="drug-detail-header">
                    <div>
                        <div class="drug-detail-name">${drug.name}</div>
                        <div class="drug-detail-pinyin">${drug.pinyin}</div>
                        <div class="drug-detail-latin">${drug.latin}</div>
                    </div>
                </div>
                <div class="drug-detail-content">
                    <div>
                        <div class="drug-detail-section">
                            <h3>性味归经</h3>
                            <div class="drug-detail-text">${drug.properties}</div>
                        </div>
                        <div class="drug-detail-section">
                            <h3>功效</h3>
                            <div class="drug-detail-text">${drug.efficacy}</div>
                        </div>
                        <div class="drug-detail-section">
                            <h3>用法用量</h3>
                            <div class="drug-detail-text">${drug.usage}</div>
                        </div>
                        <div class="drug-detail-section">
                            <h3>禁忌</h3>
                            <div class="drug-detail-text">${drug.contraindications}</div>
                        </div>
                    </div>
                    <div>
                        <div class="drug-detail-section">
                            <h3>药物描述</h3>
                            <div class="drug-detail-text">${drug.description}</div>
                        </div>
                        ${drug.imageUrl ? `
                        <div class="drug-detail-section">
                            <h3>药物图片</h3>
                            <img src="${drug.imageUrl}" alt="${drug.name}" class="drug-detail-image" onerror="this.style.display='none'">
                        </div>` : ''}
                    </div>
                </div>
            `;
            
            // 切换视图
            listContainer.style.display = 'none';
            detailContainer.style.display = 'block';
        }
        function hideDrugDetail() {
            const detailContainer = document.getElementById('drug-detail');
            detailContainer.classList.remove('active');
            currentDrugDetail = null;
        }
        function backToDrugsList() {
            const detailContainer = document.getElementById('drug-detail');
            const listContainer = document.getElementById('drugs-grid-container');
            
            // 隐藏详情，显示列表
            detailContainer.style.display = 'none';
            listContainer.style.display = 'grid'; // 如果原本是grid布局
        }
        function performDrugSearch() {
            const query = document.getElementById('drug-search-input').value.trim().toLowerCase();
            const category = document.getElementById('drug-category-filter').value;
            
            let filteredDrugs = drugsData;
            
            if (query) {
                filteredDrugs = filteredDrugs.filter(drug => 
                    drug.name.toLowerCase().includes(query) ||
                    drug.pinyin.toLowerCase().includes(query) ||
                    drug.latin.toLowerCase().includes(query) ||
                    drug.efficacy.toLowerCase().includes(query)
                );
            }
            
            if (category) {
                filteredDrugs = filteredDrugs.filter(drug => drug.category === category);
            }
            
            displayDrugsGrid(filteredDrugs);
            
            // 隐藏当前显示的药物详情
            hideDrugDetail();
        }

        // 显示卷详情
        function showVolume(volumeNumber) {
            currentVolume = volumeNumber;
            const volumeDetail = document.getElementById('volume-detail');
            const volumeGrid = document.querySelector('.volume-grid');
            
            volumeGrid.style.display = 'none';
            volumeDetail.style.display = 'block';

            const pages = volumePages[volumeNumber] || [];
            currentVolumePages = pages;
            
            volumeDetail.innerHTML = `
                <button class="btn back-btn" onclick="backToVolumeList()">返回卷目列表</button>
                <h2>第${volumeNumber}卷 - ${volumeTitles[volumeNumber] || ""}</h2>
                <p>${volumeDescriptions[volumeNumber] || ""}</p>
                <h3 style="margin-top: 20px;">页面列表</h3>
                <div class="pages-grid">
                    ${pages.map(page => `
                        <div class="page-card" data-volume="${volumeNumber}" data-page="${page.number}" 
                             data-pdf="${encodeURIComponent(page.pdfUrl || '')}" 
                             data-image="${encodeURIComponent(page.imageUrl || '')}">
                            <span class="page-number">第 ${page.number} 页</span>
                            <div class="page-preview">${page.description || ""}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            // 绑定点击事件
            const pageCards = volumeDetail.querySelectorAll('.page-card');
            pageCards.forEach(card => {
                card.addEventListener('click', function() {
                    const vol = Number(this.dataset.volume);
                    const pg = Number(this.dataset.page);
                    const pdf = decodeURIComponent(this.dataset.pdf || '');
                    const image = decodeURIComponent(this.dataset.image || '');
                    
                    // 优先尝试PDF，如果PDF不可用则使用图片
                    if (pdf) {
                        viewPDF(vol, pg, pdf);
                    } else if (image) {
                        viewImage(vol, pg, image);
                    } else {
                        alert('该页面暂无可用资源');
                    }
                });
            });
        }

        function backToVolumeList() {
            document.getElementById('volume-detail').style.display = 'none';
            document.getElementById('pdf-viewer').style.display = 'none';
            document.getElementById('image-viewer').style.display = 'none';
            document.querySelector('.volume-grid').style.display = 'grid';
        }
        
        function backToPages() {
            document.getElementById('pdf-viewer').style.display = 'none';
            document.getElementById('image-viewer').style.display = 'none';
            document.getElementById('volume-detail').style.display = 'block';
        }

        // 打开PDF（初始化）
        function viewPDF(volumeNumber, pageNumber, pdfUrl) {
            currentVolume = volumeNumber;
            currentPage = pageNumber;
            currentPDFUrl = pdfUrl;
            
            // 计算总页数
            totalPages = currentVolumePages.length;
            
            document.getElementById('volume-detail').style.display = 'none';
            document.getElementById('image-viewer').style.display = 'none';
            const pdfViewer = document.getElementById('pdf-viewer');
            pdfViewer.style.display = 'block';
            
            document.getElementById('viewer-title').textContent = `第${volumeNumber}卷 - PDF预览`;
            document.getElementById('page-count').textContent = totalPages;
            
            // 加载指定页
            loadPDFPage(currentPage);
            
            // 更新页面输入框
            const pageInput = document.getElementById('page-input');
            pageInput.value = currentPage;
            pageInput.max = totalPages;
            
            // 更新按钮状态
            updateNavigationButtons();
        }

        // 加载PDF页面（单页）
        function loadPDFPage(pageNum) {
            if (isLoading) return;
            
            isLoading = true;
            const loadingOverlay = document.getElementById('pdf-loading');
            loadingOverlay.classList.add('active');
            
            currentPage = pageNum;
            
            // 更新iframe的src，只加载指定页
            const iframe = document.getElementById('pdf-iframe');
            const viewerUrl = `${viewerBase}?file=${encodeURIComponent(currentPDFUrl)}#page=${pageNum}&zoom=${currentZoom}`;
            
            // 监听iframe加载完成
            iframe.onload = function() {
                isLoading = false;
                loadingOverlay.classList.remove('active');
                
                // 更新文本显示
                showPageText(currentVolume, currentPage, lastSearchQuery);
                
                // 更新页码显示
                document.getElementById('page-input').value = currentPage;
                document.getElementById('current-page-text').textContent = currentPage;
                
                // 更新按钮状态
                updateNavigationButtons();
            };
            
            iframe.onerror = function() {
                isLoading = false;
                loadingOverlay.classList.remove('active');
                console.error('PDF加载失败，尝试使用图片模式');
                
                // 尝试查找对应的图片URL
                const currentPageInfo = currentVolumePages.find(p => p.number === currentPage);
                if (currentPageInfo && currentPageInfo.imageUrl) {
                    viewImage(currentVolume, currentPage, currentPageInfo.imageUrl);
                } else {
                    alert('PDF加载失败，请检查文件路径或CORS设置');
                }
            };
            
            iframe.src = viewerUrl;
        }

        // 打开图片查看器
        function viewImage(volumeNumber, pageNumber, imageUrl) {
            currentVolume = volumeNumber;
            currentPage = pageNumber;
            currentImageUrl = imageUrl;
            
            // 计算总页数
            totalPages = currentVolumePages.length;
            
            document.getElementById('volume-detail').style.display = 'none';
            document.getElementById('pdf-viewer').style.display = 'none';
            const imageViewer = document.getElementById('image-viewer');
            imageViewer.style.display = 'block';
            
            document.getElementById('image-viewer-title').textContent = `第${volumeNumber}卷 - 图片预览`;
            document.getElementById('image-page-count').textContent = totalPages;
            
            // 加载图片
            loadImagePage(currentPage);
            
            // 更新页面输入框
            const pageInput = document.getElementById('image-page-input');
            pageInput.value = currentPage;
            pageInput.max = totalPages;
            
            // 更新按钮状态
            updateImageNavigationButtons();
            
            // 重置缩放
            imageZoom = 1;
            updateImageZoom();
        }

        // 加载图片页面
        function loadImagePage(pageNum) {
            currentPage = pageNum;
            
            // 查找当前页面的图片URL
            const currentPageInfo = currentVolumePages.find(p => p.number === currentPage);
            if (!currentPageInfo) return;
            
            const imageUrl = currentPageInfo.imageUrl || currentPageInfo.pdfUrl?.replace('.pdf', '.jpg');
            if (!imageUrl) return;
            
            const img = document.getElementById('viewer-image');
            img.src = imageUrl;
            img.onload = function() {
                // 更新文本显示
                showImagePageText(currentVolume, currentPage, lastSearchQuery);
                
                // 更新页码显示
                document.getElementById('image-page-input').value = currentPage;
                document.getElementById('current-image-page-text').textContent = currentPage;
                
                // 更新按钮状态
                updateImageNavigationButtons();
            };
            
            img.onerror = function() {
                console.error('图片加载失败');
                alert('图片加载失败，请检查文件路径');
            };
        }

        // 更新导航按钮状态
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }
        
        function updateImageNavigationButtons() {
            const prevBtn = document.getElementById('image-prev-btn');
            const nextBtn = document.getElementById('image-next-btn');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }

        // 翻页功能
        function prevPage() {
            if (currentPage > 1 && !isLoading) {
                // 查找上一页的信息
                const prevPageInfo = currentVolumePages.find(p => p.number === currentPage - 1);
                if (prevPageInfo && prevPageInfo.pdfUrl) {
                    viewPDF(currentVolume, currentPage - 1, prevPageInfo.pdfUrl);
                }
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages && !isLoading) {
                // 查找下一页的信息
                const nextPageInfo = currentVolumePages.find(p => p.number === currentPage + 1);
                if (nextPageInfo && nextPageInfo.pdfUrl) {
                    viewPDF(currentVolume, currentPage + 1, nextPageInfo.pdfUrl);
                }
            }
        }
        
        function prevImagePage() {
            if (currentPage > 1) {
                // 查找上一页的信息
                const prevPageInfo = currentVolumePages.find(p => p.number === currentPage - 1);
                if (prevPageInfo && (prevPageInfo.imageUrl || prevPageInfo.pdfUrl)) {
                    const imageUrl = prevPageInfo.imageUrl || prevPageInfo.pdfUrl.replace('.pdf', '.jpg');
                    viewImage(currentVolume, currentPage - 1, imageUrl);
                }
            }
        }
        
        function nextImagePage() {
            if (currentPage < totalPages) {
                // 查找下一页的信息
                const nextPageInfo = currentVolumePages.find(p => p.number === currentPage + 1);
                if (nextPageInfo && (nextPageInfo.imageUrl || nextPageInfo.pdfUrl)) {
                    const imageUrl = nextPageInfo.imageUrl || nextPageInfo.pdfUrl.replace('.pdf', '.jpg');
                    viewImage(currentVolume, currentPage + 1, imageUrl);
                }
            }
        }
        
        // 跳转到指定页
        function goToPage(pageNum) {
            pageNum = parseInt(pageNum);
            if (pageNum >= 1 && pageNum <= totalPages && pageNum !== currentPage && !isLoading) {
                // 查找指定页的信息
                const pageInfo = currentVolumePages.find(p => p.number === pageNum);
                if (pageInfo && pageInfo.pdfUrl) {
                    viewPDF(currentVolume, pageNum, pageInfo.pdfUrl);
                }
            }
        }
        
        function goToImagePage(pageNum) {
            pageNum = parseInt(pageNum);
            if (pageNum >= 1 && pageNum <= totalPages && pageNum !== currentPage) {
                // 查找指定页的信息
                const pageInfo = currentVolumePages.find(p => p.number === pageNum);
                if (pageInfo && (pageInfo.imageUrl || pageInfo.pdfUrl)) {
                    const imageUrl = pageInfo.imageUrl || pageInfo.pdfUrl.replace('.pdf', '.jpg');
                    viewImage(currentVolume, pageNum, imageUrl);
                }
            }
        }

        // 缩放功能
        function zoomIn() {
            currentZoom = 'in';
            updateZoom();
        }
        
        function zoomOut() {
            currentZoom = 'out';
            updateZoom();
        }
        
        function fitWidth() {
            currentZoom = 'page-width';
            updateZoom();
        }
        
        function fitPage() {
            currentZoom = 'page-fit';
            updateZoom();
        }
        
        function updateZoom() {
            // 重新加载当前页面，应用新的缩放设置
            loadPDFPage(currentPage);
        }
        
        function zoomImageIn() {
            imageZoom += 0.2;
            updateImageZoom();
        }
        
        function zoomImageOut() {
            imageZoom = Math.max(0.2, imageZoom - 0.2);
            updateImageZoom();
        }
        
        function resetImageZoom() {
            imageZoom = 1;
            updateImageZoom();
        }
        
        function updateImageZoom() {
            const img = document.getElementById('viewer-image');
            img.style.transform = `scale(${imageZoom})`;
            img.style.transformOrigin = 'top left';
        }

        // 在新标签页打开
        function openViewerInNewTab() {
            if (!currentPDFUrl) {
                alert('当前没有打开的PDF');
                return;
            }
            const url = `${viewerBase}?file=${encodeURIComponent(currentPDFUrl)}#page=${currentPage}&zoom=${currentZoom}`;
            window.open(url, '_blank');
        }

        // 下载PDF
        function downloadCurrentPDF() {
            if (!currentPDFUrl) {
                alert('没有可下载的PDF');
                return;
            }
            window.open(currentPDFUrl, '_blank');
        }
        
        // 下载图片
        function downloadCurrentImage() {
            if (!currentImageUrl) {
                alert('没有可下载的图片');
                return;
            }
            window.open(currentImageUrl, '_blank');
        }

        // 显示页面文本
        function showPageText(volume, page, highlightQuery = "") {
            const raw = (pageTexts[volume] && pageTexts[volume][page]) || "暂无文本";
            currentPageTextRaw = raw;
            const html = highlightQuery 
                ? highlightMatches(raw, highlightQuery, false) 
                : raw;
            document.getElementById('page-text').innerHTML = html;
            document.getElementById('page-text-search').value = highlightQuery || "";
        }
        
        function showImagePageText(volume, page, highlightQuery = "") {
            const raw = (pageTexts[volume] && pageTexts[volume][page]) || "暂无文本";
            currentPageTextRaw = raw;
            const html = highlightQuery 
                ? highlightMatches(raw, highlightQuery, false) 
                : raw;
            document.getElementById('image-page-text').innerHTML = html;
            document.getElementById('image-page-text-search').value = highlightQuery || "";
        }
        
        // 文本搜索高亮
        function updatePageTextHighlightFromInput() {
            const q = document.getElementById('page-text-search').value.trim();
            const html = q ? highlightMatches(escapeHTML(currentPageTextRaw), q, false) : escapeHTML(currentPageTextRaw);
            document.getElementById('page-text').innerHTML = html;
        }
        
        function updateImagePageTextHighlightFromInput() {
            const q = document.getElementById('image-page-text-search').value.trim();
            const html = q ? highlightMatches(escapeHTML(currentPageTextRaw), q, false) : escapeHTML(currentPageTextRaw);
            document.getElementById('image-page-text').innerHTML = html;
        }

        // 复制文本
        function copyPageText() {
            if (!currentPageTextRaw) return;
            navigator.clipboard?.writeText(currentPageTextRaw).then(() => {
                const btn = document.getElementById('copy-page-text');
                const old = btn.textContent;
                btn.textContent = '已复制';
                setTimeout(() => btn.textContent = old, 1200);
            }).catch(() => alert('复制失败'));
        }
        
        function copyImagePageText() {
            if (!currentPageTextRaw) return;
            navigator.clipboard?.writeText(currentPageTextRaw).then(() => {
                const btn = document.getElementById('copy-image-page-text');
                const old = btn.textContent;
                btn.textContent = '已复制';
                setTimeout(() => btn.textContent = old, 1200);
            }).catch(() => alert('复制失败'));
        }

        // 获取PDF URL
        function getPdfUrl(volume, page) {
            const arr = volumePages[volume] || [];
            const item = arr.find(p => p.number === page);
            return item ? item.pdfUrl : '';
        }

        // 打开搜索结果
        function openResult(volume, page, query) {
            lastSearchQuery = query || "";
            showSection('browse');
            showVolume(volume);
            const url = getPdfUrl(volume, page);
            if (url) {
                viewPDF(volume, page, url);
            } else {
                // 尝试使用图片
                const arr = volumePages[volume] || [];
                const item = arr.find(p => p.number === page);
                if (item && item.imageUrl) {
                    viewImage(volume, page, item.imageUrl);
                } else {
                    alert('未找到该页的资源地址。');
                }
            }
        }

        // 快速搜索
        function performSearch() {
            const query = document.getElementById('quick-search-input').value || "";
            if (!query.trim()) return;
            showSection('search');
            document.getElementById('search-input').value = query.trim();
            performDetailedSearch();
        }

        // 详细搜索
        function performDetailedSearch() {
            const input = document.getElementById('search-input');
            const query = (input.value || "").trim();
            const exact = !!document.getElementById('filter-exact').checked;
            const onlyPres = !!document.getElementById('filter-prescription').checked;
            const volFilter = document.getElementById('search-volume-filter').value;
            const resultsDiv = document.getElementById('search-results');

            if (!query) {
                resultsDiv.innerHTML = '<p>请输入搜索关键词</p>';
                return;
            }

            const tokens = exact ? [query] : query.split(/\s+/).filter(Boolean);
            const matchOne = (text) => {
                if (!text) return false;
                const lowerText = text.toLowerCase();
                if (exact) return lowerText.includes(query.toLowerCase());
                return tokens.every(t => lowerText.includes(t.toLowerCase()));
            };

            let results = searchIndex.filter(r => {
                if (volFilter && String(r.volume) !== volFilter) return false;
                if (onlyPres && !(r.tags || []).includes("方剂")) return false;
                return matchOne(r.text);
            });

            if (!results.length) {
                resultsDiv.innerHTML = `<p>未找到与"${escapeHTML(query)}"相关的结果。</p>`;
                return;
            }

            const html = [
                `<h3>搜索结果（${results.length} 条）</h3>`,
                ...results.map(r => {
                    const snippet = getSnippet(r.text, query, exact, 50);
                    return `
                        <div class="entry-card">
                            <div class="entry-title">卷 ${r.volume} · 第 ${r.page} 页</div>
                            <div class="entry-preview">${snippet}</div>
                            <div class="entry-meta">
                                <span>分类：${(r.tags && r.tags.length) ? r.tags.join('、') : '—'}</span>
                            </div>
                            <div class="entry-actions">
                                <button class="btn-link" onclick="openResult(${r.volume}, ${r.page}, '${(query || '').replace(/'/g, "\\'")}')">打开此页</button>
                            </div>
                        </div>
                    `;
                })
            ].join('');
            resultsDiv.innerHTML = html;
        }

        // 事件绑定
        document.addEventListener('DOMContentLoaded', () => {
            // 页面文本搜索
            const pageTextInput = document.getElementById('page-text-search');
            if (pageTextInput) {
                pageTextInput.addEventListener('input', updatePageTextHighlightFromInput);
            }
            
            const imagePageTextInput = document.getElementById('image-page-text-search');
            if (imagePageTextInput) {
                imagePageTextInput.addEventListener('input', updateImagePageTextHighlightFromInput);
            }
            
            // 复制按钮
            const copyBtn = document.getElementById('copy-page-text');
            if (copyBtn) {
                copyBtn.addEventListener('click', copyPageText);
            }
            
            const copyImageBtn = document.getElementById('copy-image-page-text');
            if (copyImageBtn) {
                copyImageBtn.addEventListener('click', copyImagePageText);
            }
            
            // 页码输入框
            const pageInput = document.getElementById('page-input');
            if (pageInput) {
                pageInput.addEventListener('change', function() {
                    goToPage(this.value);
                });
                
                pageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        goToPage(this.value);
                    }
                });
            }
            
            const imagePageInput = document.getElementById('image-page-input');
            if (imagePageInput) {
                imagePageInput.addEventListener('change', function() {
                    goToImagePage(this.value);
                });
                
                imagePageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        goToImagePage(this.value);
                    }
                });
            }
            
            // 药物搜索框回车事件
            const drugSearchInput = document.getElementById('drug-search-input');
            if (drugSearchInput) {
                drugSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performDrugSearch();
                    }
                });
            }
        });

        // 加载数据
        fetch('./volume-content.json')
            .then(response => response.json())
            .then(data => {
                volumePages = data.volumePages || {};
                pageTexts = data.pageTexts || {};
                pageMeta = data.pageMeta || {};
                buildSearchIndex();
            })
            .catch(err => {
                console.warn('无法加载 JSON 数据:', err);
                // 示例数据
                volumePages = {
                    1: [
                        { number: 1, pdfUrl: './samples/vol1-page1.pdf', imageUrl: './samples/vol1-page1.jpg', description: '示例：卷1 第1页' },
                        { number: 2, pdfUrl: './samples/vol1-page2.pdf', imageUrl: './samples/vol1-page2.jpg', description: '示例：卷1 第2页' },
                        { number: 3, pdfUrl: './samples/vol1-page3.pdf', imageUrl: './samples/vol1-page3.jpg', description: '示例：卷1 第3页' }
                    ]
                };
                pageTexts = {
                    1: {
                        1: '这是卷1第1页的示例文本内容。',
                        2: '这是卷1第2页的示例文本内容。',
                        3: '这是卷1第3页的示例文本内容。'
                    }
                };
                pageMeta = {};
                buildSearchIndex();
            });
    </script>
</body>
</html>
